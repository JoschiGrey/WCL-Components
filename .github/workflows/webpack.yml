name: NodeJS with Webpack

on:
  push:
    branches: [ "main" ]
    paths-ignore:
      - "dist/**"


jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 16

    - name: Build
      run: |
        npm install
        npx webpack --no-watch

    - name: Generate commit message and hash
      run: |
        git config user.name "GitHub Actions Bot"
        git config user.email "github-actions-bot@example.com"
        git remote set-url origin https://github.com/JoschiGrey/WCL-Components.git
        git fetch origin
        git checkout -b build_output
        commit_message=$(git log --format=%s -n 1 | sed 's/^commit //')
        commit_hash=$(git log --pretty=format:%H -n 1)
        git add dist
        git commit -m "$commit_message"
        git push origin build_output

